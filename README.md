# フロイド・ワーシャル法 可視化ツール - 開発メモ

## 🔗 ツールへのアクセス

**実際のツールはこちらからご利用いただけます:**  
🌐 [フロイド・ワーシャル法 可視化ツール](https://gemini.google.com/share/a580ee108293)

---

## 概要

このドキュメントは、全点対間最短路問題を解くための「**フロイド・ワーシャル法**」のアルゴリズムを、インタラクティブに可視化する静的なWebサイトの開発メモです。

ユーザーはグラフの構造を隣接行列で定義し、アルゴリズムがステップごとにどのように最短経路を更新していくかを視覚的に追跡できます。教育的な目的で、アルゴリズムの挙動を直感的に理解することを支援します。

## 主な特徴

- 📊 **リアルタイム可視化**: アルゴリズムの各ステップを視覚的に表示
- 🎮 **インタラクティブ操作**: 自動再生、一時停止、ステップ実行が可能
- 📝 **カスタムグラフ**: 隣接行列を入力して任意のグラフを解析
- 🎯 **教育向け**: アルゴリズムの理解を深める詳細なログ表示

## 機能一覧

### グラフの動的可視化
- 隣接行列に基づいて、ノードと重み付き有向エッジからなるグラフをSVGで描画します
- エッジは曲線で描画され、重なり合うノード間のエッジも見やすく表示されます

### 最短経路テーブルの表示
- アルゴリズムの進行状況を反映する最短経路テーブル（dist行列）をリアルタイムで表示します

### ステップごとの実行制御
- 「自動再生」「一時停止」「次へ」ボタンにより、アルゴリズムの実行を制御できます
- 再生速度もスライダーで調整可能です

### 動的なハイライト
- 現在の中継点 k、始点 i、終点 j に対応するノードとテーブルの行・列を色分けしてハイライトします
- 経路の更新が行われる際には、対象となるセルがアニメーションとともにハイライトされ、どの経路 (i → k → j) が採用されたかを明確に示します

### 実行ログ
- 各ステップでの計算内容（`dist[i][j]` と `dist[i][k] + dist[k][j]` の比較）をテキストで表示し、詳細なトレースを可能にします

### カスタムグラフ定義
- ユーザーがテキストエリアに隣接行列を入力することで、任意のグラフを対象にアルゴリズムを実行できます

## 実装詳細

このセクションでは、ツールの技術的な実装について説明します。実際のコードは上記リンクのツールに含まれています。

### 技術スタック

- **HTML5**: アプリケーションの基本的な構造を定義
- **Tailwind CSS**: UIのスタイリングを効率的に行うためのユーティリティファーストCSSフレームワーク
- **JavaScript (ES6+)**: アルゴリズムのロジック、DOM操作、インタラクションなど、アプリケーションの全機能を制御
  - 外部ライブラリへの依存はなく、標準のJavaScriptのみで実装

ツールは単一のHTMLファイルとして構成されており、HTML、CSS（`<style>`タグ内）、JavaScript（`<script>`タグ内）がすべて含まれています。これにより、配布や利用が容易になっています。

## 使用方法

**ツールを使用するには、上記のリンクからアクセスしてください。**

基本的な使用手順：

1. **ツールにアクセス**: [リンク](https://gemini.google.com/share/a580ee108293)からツールを開きます
2. **グラフを定義**: テキストエリアに隣接行列を入力します（デフォルトのサンプルも利用可能）
3. **初期化**: 「初期化」ボタンを押してグラフを生成します
4. **実行**: 以下のボタンでアルゴリズムを制御します：
   - 「自動再生」: アルゴリズムを自動的に実行
   - 「一時停止」: 自動再生を停止
   - 「次へ」: 1ステップずつ実行
   - 「リセット」: 初期状態に戻す

## 隣接行列の入力形式

隣接行列は以下の形式で入力してください：

```
0 3 ∞ 7
8 0 2 ∞
5 ∞ 0 1
2 ∞ ∞ 0
```

- `0`: 自分自身への距離（通常は0）
- `∞`: 直接的な経路が存在しない場合
- 数値: エッジの重み

## アーキテクチャと実装

### 状態管理

アルゴリズムの実行状態を管理するために、以下の主要なグローバル変数を定義しています：

- `dist`: 現在の最短経路を保持する2次元配列。アルゴリズムによって更新されます
- `initialDist`: ユーザーが定義した初期の隣接行列。リセット時に使用します
- `nodes`: 各ノードのIDと描画位置（x, y座標）を保持するオブジェクトの配列
- `k, i, j`: フロイド・ワーシャル法の3重ループの現在のインデックス
- `animationInterval`: setIntervalのID。自動再生の制御に使用します

### 初期化と描画

#### `init()`
- アプリケーションの起点となる関数
- `parseGraphDefinition()` を呼び出してテキストエリアから隣接行列を読み込み、`dist` 配列を初期化
- `drawGraph()` と `drawMatrix()` を呼び出して、初期状態のグラフとテーブルを描画

#### `drawGraph()`
- `nodes` 配列の情報に基づいて、SVGとHTML要素（div）を組み合わせてグラフを描画
- エッジはSVGの `<path>` 要素で、ノードはHTMLの `<div>` 要素で表現
- CSSでのスタイリングが容易になるよう設計
- エッジは曲線で描画し、重なり合うノード間のエッジも見やすく配置

#### `drawMatrix()`
- `dist` 配列に基づいて、HTMLの `<table>` を動的に生成

### アルゴリズムの核心 (`floydWarshallGenerator`)

フロイド・ワーシャル法の3重ループを**ジェネレータ関数** (`function*`) として実装しています。`yield` キーワードを使うことで、ループの各ステップ（比較(check)と更新(update)）で処理を一時停止し、外部に制御を戻すことができます。

これにより、「自動再生」や「次へ」といったステップごとの実行制御が極めてシンプルに実装できます。

```javascript
function* floydWarshallGenerator() {
    for (k = 0; k < numNodes; k++) {
        for (i = 0; i < numNodes; i++) {
            for (j = 0; j < numNodes; j++) {
                // 比較前に状態をyield
                yield {k, i, j, phase: 'check'};
                
                // 更新条件を満たす場合
                if (dist[i][j] > dist[i][k] + dist[k][j]) {
                    // 更新前に状態をyield
                    // 更新前に状態をyield
                    yield {k, i, j, phase: 'update'};
                    dist[i][j] = dist[i][k] + dist[k][j];
                }
            }
        }
    }
    // 完了状態をyield
    yield {phase: 'done'};
}
```

### 可視化の更新 (`updateVisualization`)

ジェネレータから受け取った現在の状態 (`k`, `i`, `j`, `phase`) に基づいて、UIのハイライトを更新します。

- CSSクラスの付け外しによって、ノード、エッジ、テーブルのセルのスタイルを動的に変更
- 経路が更新される際には、`highlight-update` クラスを適用し、視覚的なフィードバックをユーザーに提供

### 操作パネルのロジック

各ボタンのイベントリスナが、以下の関数を呼び出します：

- `startAnimation`: `setInterval` を使って `step()` 関数を定期的に呼び出し、自動再生を実現
- `stopAnimation`: 自動再生を停止
- `step`: ジェネレータの `next()` メソッドを呼び出し、アルゴリズムを1ステップ進める
- `handleReset`: 初期状態にリセット

## プロンプト
Google Geminiに投げたプロンプト
- 全点対間最短路問題：フロイド・ワーシャル法について調べ、そのアルゴリズムの可視化Webサイトを作成してください。
- 理解を深めるためにアルゴリズムのログを表示出来るようにしてください
- 可視化のデザインを見やすくしてください
